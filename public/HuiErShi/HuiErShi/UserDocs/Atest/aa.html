<!-- 马少博  创建于 2017年3月13日14:54:28 -->
<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel='shortcut icon' href='https://raw.githubusercontent.com/OldSixLi/ListPage/master/myapp/public/images/my.ico' />
  <title> </title>
  <!-- Bootstrap引用 -->
  <link href='http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css' rel='stylesheet'>
  <link href="../../Styles/select2.min.css" rel="stylesheet" type="text/css">
  <style>
    .img-block {
      width: 200px;
      height: 200px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="row">
      <!-- 消除外边距 -->
      <div class="col-md-12">
        <div id="btn-uploader" class="text-center">
          <a id="pickfiles" href="javascript:void 0;"> <img src='../../images/7.png' id="img" class='img-responsive img-thumbnail img-block' style="width:200px;height:200px;" alt='自定义'></a>
        </div>

      </div>
    </div>
  </div>

  <!-- 脚本 -->
  <!-- <script src='http://cdn.bootcss.com/angular.js/1.4.1/angular.js'></script> -->
  <script src='http://cdn.bootcss.com/jquery/1.9.1/jquery.min.js'></script>
  <script type="text/javascript" src="../../Scripts/select2.full.min.js"></script>
  <script src='http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
  <script type="text/javascript" src="http://cdn.staticfile.org/plupload/3.0-beta1/plupload.min.js"></script>
  <script type="text/javascript" src="../../Scripts/plupload.full.min.js"></script>
  <script type="text/javascript" src="../../Scripts/moxie.js"></script>
  <script type="text/javascript" src="../../Scripts/qiniu.min.js"></script>
  <script>
    var domainUrl = "http://omsss06f1.bkt.clouddn.com/";

    //获取七牛uptoken　
    uploader = Qiniu.uploader({
      runtimes: 'html5,flash,html4',
      browse_button: 'pickfiles', //上传按钮的ID
      container: 'btn-uploader', //上传按钮的上级元素ID
      drop_element: 'btn-uploader',
      max_file_size: '100mb', //最大文件限制　
      dragdrop: false,
      chunk_size: '4mb', //分块大小 
      unique_names: true,
      save_key: true,
      uptoken_func: function() { // 在需要获取uptoken时，该方法会被调用　
        var token = "";
        $.ajax({
          type: "get",
          url: "http://60.205.170.209:8080/admin/api/qnToken",
          async: false,
          dataType: "json",
          success: function(data) {
            token = data.upToken;
          }
        });
        return token;
      },
      unique_names: false,
      domain: domainUrl, //自己的七牛云存储空间域名
      multi_selection: false, //是否允许同时选择多文件
      //文件类型过滤，这里限制为图片类型
      filters: {
        mime_types: [{
          title: "Image files",
          extensions: "jpg,jpeg,gif,png"
        }]
      },
      auto_start: true,
      init: {
        'FilesAdded': function(up, files) {
          //do something
        },
        'BeforeUpload': function(up, file) {
          //do something
        },
        'UploadProgress': function(up, file) {
          //可以在这里控制上传进度的显示
          //可参考七牛的例子
        },
        'UploadComplete': function() {
          //do something
        },
        'FileUploaded': function(up, file, info) {　
          var json = JSON.parse(info);
          console.log(JSON.stringify(json.key));
          $("#img").attr("src", domainUrl + json.key);
        },
        'Error': function(up, err, errTip) {
          alert(errTip);
        },
        'Key': function(up, file) {
          //当save_key和unique_names设为false时，该方法将被调用
          var key = nowTime + file.name;　
          return key;
        }
      }
    });

    //自动获取当前日期时分秒给上传的图片命名
    var date = new Date();
    var year = date.getFullYear();
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    if (month >= 1 && month <= 9) {
      month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
      strDate = "0" + strDate;
    }
    var hours = date.getHours(); //获取系统时，
    var minutes = date.getMinutes(); //分
    var seconds = date.getSeconds(); //秒
    var nowTime = year + "" + month + "" + strDate + "" + hours + "" + minutes + "" + seconds;
    $("#picPath").html("请选择文件");
  </script>
</body>

</html>